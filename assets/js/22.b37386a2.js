(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{223:function(a,t,e){"use strict";e.r(t);var s=e(0),n=Object(s.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("p",[a._v("最近给公司搞了个zabbix平台监测，不得不说，网上的文章太杂了\n下面是我使用成功在centos7安装zabbix 3.11.4的命令\n1.1 安装依赖包：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("yum -y install wget net-snmp-devel OpenIPMI-devel httpd openssl-devel java lrzsz fping-devel libcurl-devel perl-DBI pcre-devel libxml2 libxml2-devel mysql-devel gcc php php-bcmath php-gd php-xml php-mbstring php-ldap php-mysql.x86_64 php-pear php-xmlrpc  net-tools wget vim-enhanced\n")])])]),e("p",[a._v("1.2 关闭防火墙：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('# systemctl stop firewalld.service\n# systemctl disable firewalld.service \n需要关闭 selinux，一定要关闭这个，开启selinux会引起一连串问题，甚至zabbix的discovery功能也不能正常使用\n# sed -i "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/selinux/config\n确认是否修改成功\n# grep SELINUX /etc/selinux/config\n然后重启系统即可\n\n# reboot\n')])])]),e("p",[a._v("2.1 搭建lamp环境\n在centos7上安装zabbix server3.0之前，我们首先搭建zabbix所需要的lamp环境。")]),a._v(" "),e("p",[a._v("下载最新的yum源，如下：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("# wget -P /etc/yum.repos.d http://mirrors.aliyun.com/repo/Centos-7.repo\n")])])]),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf289ca12ca6f?w=500&h=138&f=png&s=54932",alt:"image.png"}}),a._v("\n在开始安装之前，还需要说明下centos7自带的mysql是mariadb，我们可以通过如下命令查看：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("yum search mysql|tac\n")])])]),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf289cac5b93a?w=550&h=117&f=png&s=20151",alt:"image.png"}}),a._v("\n现在开始安装lamp环境，使用如下命令：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("yum -y install mariadb mariadb-server php php-mysql httpd\n")])])]),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf289caebc541?w=500&h=210&f=png&s=99112",alt:"image.png"}})]),a._v(" "),e("p",[a._v("通过上图，我们可以很明显的看出centos7默认安装的是php5.4、httpd2.4和maradb5.5，这个完全符合zabbix3.0对软件版本的要求。")]),a._v(" "),e("p",[a._v("lamp安装完毕后，我们现在来配置mysql数据库。")]),a._v(" "),e("p",[a._v("设置开机自启动mysql，并启动mysql，使用如下命令：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@zabbix ~]# systemctl enable mariadb.service\n[root@zabbix ~]# systemctl start mariadb.service\n")])])]),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf289cc84fa02?w=886&h=66&f=png&s=3094",alt:"image.png"}}),a._v("\n初始化mysql数据库，并配置root用户密码。使用如下命令：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@zabbix ~]# mysql_secure_installation\n")])])]),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf289cde7dd14?w=500&h=342&f=png&s=104894",alt:"image.png"}}),a._v(" "),e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf289cdfa42e9?w=426&h=136&f=png&s=2147",alt:"image.png"}}),a._v(" "),e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf289f31c1c10?w=500&h=409&f=png&s=105873",alt:"image.png"}}),a._v("\n注意：在上图中的Enter current passwdord for root处，我们直接敲回车键即可。因为centos7上mysql的默认root用户密码为空。\n上图中主要是为root用户配置密码，并刷新相关权限。（密码设为123456，只为实验用，生产环境自定义）\nRemove anonymous users? 删除匿名用户？\nDisallow root login remotely? 禁止root远程登陆\nRemove test database and access to it? 删除测试数据库并且和访问它\nReload privilege tables now? 重新载入特权表\n上图中主要是配置匿名用户、test用户以及root用户远程连接等相关配置。\nmysql初始化完毕后，我们现在来创建zabbix数据库及其用户，使用如下命令：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('[root@zabbix ~]# mysql -uroot -p123456 -e "create database zabbix default character set utf8 collate utf8_bin;"\n\n[root@zabbix ~]# mysql -uroot -p123456 -e "grant all on zabbix.* to "zabbix"@"%" identified by "zabbix";"\n')])])]),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf289f80f9ba8?w=550&h=71&f=png&s=39165",alt:"image.png"}}),a._v("\n现在来测试刚刚创建的zabbix用户，是否可以连接mysql数据库，如下：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@zabbix ~]# mysql -uzabbix -pzabbix\n\nMariaDB [(none)]> show databases;\n\nMariaDB [(none)]> quit\n")])])]),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf289fe4f7f03?w=500&h=210&f=png&s=49276",alt:"image.png"}}),a._v("\n通过上图，我们可以很明显的看出zabbix用户是可以正常连接数据库的。")]),a._v(" "),e("p",[a._v("启动apache以及开放80端口，如下：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@zabbix ~]# systemctl start httpd.service\n\n[root@zabbix ~]# netstat -ltun\n")])])]),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a03047765?w=500&h=118&f=png&s=45381",alt:"image.png"}})]),a._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a08b208e6?w=615&h=21&f=png&s=1120",alt:"image.png"}}),a._v("\n到此lamp环境已经全部搭建完毕。\n浏览器输入IP地址即可看到如下\n"),e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a0b3a3547?w=500&h=113&f=png&s=75540",alt:"image.png"}}),a._v("\n2.2 服务器端安装zabbix server3.0（zabbix server）\nlamp环境搭建完毕后，我们现在开始正式安装zabbix3.0。")]),a._v(" "),e("p",[a._v("安装zabbix3.0所需要EPEL源和zabbix的yum源，如下：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("#rpm -ivh https://mirrors.aliyun.com/centos/6.9/extras/x86_64/Packages/epel-release-6-8.noarch.rpm\n")])])]),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a26598a68?w=500&h=65&f=png&s=33448",alt:"image.png"}})]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("#rpm -ivh http://repo.zabbix.com/zabbix/3.0/rhel/7/x86_64/zabbix-release-3.0-1.el7.noarch.rpm\n")])])]),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a2704d6e7?w=825&h=98&f=png&s=5156",alt:"image.png"}}),a._v("\n以上安装完毕后，我们现在来正式安装zabbix3.0，使用如下命令：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@zabbix ~]# yum -y install zabbix-server-mysql zabbix-web-mysql zabbix-get\n")])])]),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a309e3504?w=814&h=304&f=png&s=31892",alt:"image.png"}}),a._v(" "),e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a3d3b20be?w=827&h=129&f=png&s=4702",alt:"image.png"}})]),a._v(" "),e("p",[a._v("通过上图，我们可以很明显的看出目前zabbix server是3.0.5版本的。")]),a._v(" "),e("p",[a._v("以上安装完毕后，我们现在开始进行zabbix的相关配置。")]),a._v(" "),e("p",[a._v("导入zabbix数据库结构，如下：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@zabbix ~]# cd /usr/share/doc/zabbix-server-mysql-3.0.5/\n\n[root@zabbix zabbix-server-mysql-3.0.5]# zcat create.sql.gz | mysql -uroot -pDe123456 zabbix\n")])])]),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a3e070b44?w=732&h=67&f=png&s=3377",alt:"image.png"}}),a._v("\n数据库导入完毕后，我们现在来修改zabbix sever的配置文件，如下：（我们只需要关注 DBHost、DBName、DBUser、\nDBPassword 几项即可。这几项是配置zabbix server连接mysql数据库的参数。）")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@zabbix ~]# vi /etc/zabbix/zabbix_server.conf\n\nLogFile=/var/log/zabbix/zabbix_server.log\n\nLogFileSize=0\n\nPidFile=/var/run/zabbix/zabbix_server.pid\n\nDBHost=localhost\n\nDBName=zabbix\n\nDBUser=zabbix\n\nDBPassword=zabbix\n\nSNMPTrapperFile=/var/log/snmptrap/snmptrap.log\n\nTimeout=4\n\nAlertScriptsPath=/usr/lib/zabbix/alertscripts\n\nExternalScripts=/usr/lib/zabbix/externalscripts\n\nLogSlowQueries=3000\n")])])]),e("p",[a._v("以上修改完毕后，我们再来修改下zabbix.conf文件。如下：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("vi /etc/httpd/conf.d/zabbix.conf\n\nAlias /zabbix /usr/share/zabbix\n\nOptions FollowSymLinks\n\nAllowOverride None\n\nRequire all granted\n\nphp_value max_execution_time 300\n\nphp_value memory_limit 128M\n\nphp_value post_max_size 16M\n\nphp_value upload_max_filesize 2M\n\nphp_value max_input_time 300\n\nphp_value always_populate_raw_post_data -1\n\n   php_value date.timezone Asia/Shanghai \n")])])]),e("p",[a._v("修改最后一项php_value date.timezone Asia/Shanghai 就行，定义php的时区\n以上修改完毕后，我们把把zabbix-server加入开机启动，并启动zabbix-server，如下：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@zabbix ~]# systemctl start zabbix-server.service\n\n[root@zabbix ~]# systemctl enable zabbix-server.service\n")])])]),e("p",[a._v("最后重启apache，如下：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@zabbix ~]# systemctl restart httpd.service\n")])])]),e("p",[a._v("3.1配置zabbix\n登录http://ip/zabbix/setup.php（ip就是你服务器的IP地址）\n一开始会有要输入密码的时候，如下\n"),e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a48afcfca?w=611&h=231&f=png&s=49591",alt:"image.png"}}),a._v("\n输入之前设置的数据库密码即可\n接下来，很重要！\n一路next。。。\n然后就点登录 默认用户名是Admin 密码 zabbix 然后点击sign in\nzabbix server端就设置完毕\n4.1 配置客户端安装zabbix agent（被监测的服务器）\nzabbix agent的安装比较简单，我们只需要安装相应的仓库，然后执行安装命令即可。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@zabbix ~]# yum clean all\n\n[root@zabbix ~]# yum -y install zabbix zabbix-agent\n")])])]),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a4c3cf45b?w=500&h=156&f=png&s=64317",alt:"image.png"}}),a._v(" "),e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a5aa62ae4?w=629&h=221&f=png&s=54174",alt:"image.png"}}),a._v("\n在安装时如出现如上图所示错误，原因是软件这两个版本不一致，仔细观察发现这两个软件包使用了不同的仓库，把epel的关闭(enabled=0，位于/etc/yum.repos.d/epel.repo)再重装\n4.2 配置zabbix agent")]),a._v(" "),e("p",[a._v("zabbix agent的配置很简单，只需要修改zabbix agent配置文件中的Server、ServerActive和Hostname这三项即可。")]),a._v(" "),e("p",[a._v("其中Server、ServerActive是zabbix server服务器的IP地址，Hostname是被监控端的IP地址，如下：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@zabbix ~]# vi /etc/zabbix/zabbix_agentd.conf\n\nPidFile=/var/run/zabbix/zabbix_agentd.pid\n\nLogFile=/var/log/zabbix/zabbix_agentd.log\n\nLogFileSize=0\n\nServer=127.0.0.1\n\nServerActive=127.0.0.1\n\nHostname=127.0.0.1\n\nInclude=/etc/zabbix/zabbix_agentd.d/\n")])])]),e("p",[a._v("以上配置完毕后，我们在zabbix web端添加该监控机器时，只需要把honst name与该配置文件中的hostname对应即可。如下：")]),a._v(" "),e("p",[a._v("Server=服务器ip地址")]),a._v(" "),e("p",[a._v("ServerActive=服务器ip地址")]),a._v(" "),e("p",[a._v("Hostname=客户端ip地址")]),a._v(" "),e("p",[a._v("Server被动ServerActive主动")]),a._v(" "),e("p",[a._v("到此zabbix agent就已经安装完毕。")]),a._v(" "),e("p",[a._v("启动客户端")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@zabbix ~]# zabbix_agentd -c /etc/zabbix/zabbix_agentd.conf\n\n[root@zabbix ~]# systemctl start zabbix-agent\n\n[root@zabbix ~]# systemctl restart zabbix-agent\n\n[root@zabbix ~]# systemctl enable zabbix-agent\n")])])]),e("p",[a._v("然后在浏览器中根据下面的美图设置\n"),e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a61d1df49?w=1240&h=308&f=png&s=96888",alt:"image.png"}}),a._v("\n看到第四个了没，ZBX绿了就成功了")]),a._v(" "),e("p",[a._v("点左上角的小人就能设置语言是中文\n但是会遇到图标坐标系没有文字的问题如下")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a6cf44eff?w=376&h=212&f=png&s=15317",alt:"image.png"}}),a._v("\n解决乱码方法：\n把Windows 系统中找到 C:\\Windows\\Fonts 中的楷体（常规）用winscp （百度一下）拷贝到linux根目录\n"),e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a6fc86e4a?w=975&h=300&f=png&s=44909",alt:"image.png"}}),a._v("\n可以上传到 linux 里面了，接下来把 SIMKAI.TTF 移动到 zabbix 安装目录的 fonts 目录下")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[root@zabbix ~]# mv SIMKAI.TTF /usr/share/zabbix/fonts/\n")])])]),e("p",[a._v("可以直接按照下面的图片设置，然后再看看，是不是搞定了\n"),e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/12/21/167cf28a7b02865b?w=610&h=263&f=png&s=6823",alt:"image.png"}})])])}),[],!1,null,null,null);t.default=n.exports}}]);