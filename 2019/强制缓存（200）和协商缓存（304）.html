<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>强制缓存（200）和协商缓存（304） | Harry&#39;s Blog</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/assets/css/0.styles.c7d45e2d.css" as="style"><link rel="preload" href="/assets/js/app.4498c43d.js" as="script"><link rel="preload" href="/assets/js/2.b4182e24.js" as="script"><link rel="preload" href="/assets/js/32.867850a9.js" as="script"><link rel="prefetch" href="/assets/js/10.ec7a14d1.js"><link rel="prefetch" href="/assets/js/11.68fd43cd.js"><link rel="prefetch" href="/assets/js/12.cb531b98.js"><link rel="prefetch" href="/assets/js/13.2117fb4d.js"><link rel="prefetch" href="/assets/js/14.95f820b4.js"><link rel="prefetch" href="/assets/js/15.ff37cb81.js"><link rel="prefetch" href="/assets/js/16.f94e9052.js"><link rel="prefetch" href="/assets/js/17.ead69c87.js"><link rel="prefetch" href="/assets/js/18.517dd641.js"><link rel="prefetch" href="/assets/js/19.17d14f38.js"><link rel="prefetch" href="/assets/js/20.5bfc367a.js"><link rel="prefetch" href="/assets/js/21.c1220b6f.js"><link rel="prefetch" href="/assets/js/22.d47ea806.js"><link rel="prefetch" href="/assets/js/23.68f3d4b0.js"><link rel="prefetch" href="/assets/js/24.e95df7f3.js"><link rel="prefetch" href="/assets/js/25.d985f29f.js"><link rel="prefetch" href="/assets/js/26.c08cf248.js"><link rel="prefetch" href="/assets/js/27.d84cca50.js"><link rel="prefetch" href="/assets/js/28.bb4c1ed9.js"><link rel="prefetch" href="/assets/js/29.2003a480.js"><link rel="prefetch" href="/assets/js/3.48e27743.js"><link rel="prefetch" href="/assets/js/30.0e921be7.js"><link rel="prefetch" href="/assets/js/31.bb5d9ed1.js"><link rel="prefetch" href="/assets/js/33.0cf47229.js"><link rel="prefetch" href="/assets/js/34.554d5707.js"><link rel="prefetch" href="/assets/js/35.440ad71c.js"><link rel="prefetch" href="/assets/js/36.4a230733.js"><link rel="prefetch" href="/assets/js/37.8a4e5515.js"><link rel="prefetch" href="/assets/js/38.6fe7e942.js"><link rel="prefetch" href="/assets/js/39.3b9a3c19.js"><link rel="prefetch" href="/assets/js/4.2d108d05.js"><link rel="prefetch" href="/assets/js/40.fdee5b5a.js"><link rel="prefetch" href="/assets/js/41.0bc34dad.js"><link rel="prefetch" href="/assets/js/42.58f9d475.js"><link rel="prefetch" href="/assets/js/43.bec9e558.js"><link rel="prefetch" href="/assets/js/44.2bf75316.js"><link rel="prefetch" href="/assets/js/45.0d25d3f1.js"><link rel="prefetch" href="/assets/js/46.349a7be1.js"><link rel="prefetch" href="/assets/js/47.16c0ae27.js"><link rel="prefetch" href="/assets/js/48.d33184cd.js"><link rel="prefetch" href="/assets/js/49.71831286.js"><link rel="prefetch" href="/assets/js/5.c199e918.js"><link rel="prefetch" href="/assets/js/50.47b4afbd.js"><link rel="prefetch" href="/assets/js/51.a263a6a6.js"><link rel="prefetch" href="/assets/js/52.bb922985.js"><link rel="prefetch" href="/assets/js/6.85c03d0d.js"><link rel="prefetch" href="/assets/js/7.62c90daa.js"><link rel="prefetch" href="/assets/js/8.d4044af7.js"><link rel="prefetch" href="/assets/js/9.3beb6d47.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c7d45e2d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Harry's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2020年博客</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>js忍者秘籍读书笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>python基础学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javascript设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>过去的博客</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/2019/10个前端面试必会题.html" class="sidebar-link">10个前端面试必会题目！（适用于中高级）</a></li><li><a href="/2019/201901面试题分享.html" class="sidebar-link">201901面试题分享</a></li><li><a href="/2019/常用的一些git命令行.html" class="sidebar-link">常用的一些git命令行</a></li><li><a href="/2019/发布流程.html" class="sidebar-link">发布流程</a></li><li><a href="/2019/函数节流与防抖.html" class="sidebar-link">函数节流与防抖</a></li><li><a href="/2019/函数柯里化.html" class="sidebar-link">函数柯里化（curry)</a></li><li><a href="/2019/函数声明VS函数表达式.html" class="sidebar-link">函数声明？函数表达式？我该怎么选？！</a></li><li><a href="/2019/看懂js中this关键字的指向问题.html" class="sidebar-link">看懂js中this关键字的指向问题</a></li><li><a href="/2019/浏览器缓存的了解.html" class="sidebar-link">浏览器缓存的了解</a></li><li><a href="/2019/前端进阶学习路径.html" class="sidebar-link">前端进阶学习路径</a></li><li><a href="/2019/前端知识点190111.html" class="sidebar-link">前端知识点1901</a></li><li><a href="/2019/强制缓存（200）和协商缓存（304）.html" class="active sidebar-link">强制缓存（200）和协商缓存（304）</a></li><li><a href="/2019/如何理解es6中的class以及class中的constructor函数.html" class="sidebar-link">如何理解es6中的class以及class中的constructor函数</a></li><li><a href="/2019/如何让小孩学习javascript.html" class="sidebar-link">如何让小孩学习javascript</a></li><li><a href="/2019/十分钟了解ajax.html" class="sidebar-link">十分钟了解ajax</a></li><li><a href="/2019/是时候谈谈JavaScript面向对象了.html" class="sidebar-link">是时候谈谈JavaScript面向对象了</a></li><li><a href="/2019/手把手教你实现脚手架工具Koa-generator.html" class="sidebar-link">手把手教你实现脚手架工具Koa-generator</a></li><li><a href="/2019/HTTP请求的四种方式区别.html" class="sidebar-link">HTTP请求的四种方式区别</a></li><li><a href="/2019/javascript-闭包.html" class="sidebar-link">javascript-闭包</a></li><li><a href="/2019/Javascript常见的内存泄漏.html" class="sidebar-link">Javascript常见的内存泄漏</a></li><li><a href="/2019/javascript跨域.html" class="sidebar-link">javascript跨域</a></li><li><a href="/2019/JavaScript执行环境-执行栈.html" class="sidebar-link">JavaScript执行环境-执行栈</a></li><li><a href="/2019/MySQL8-0-12-secure-file-priv数据导出问题解决.html" class="sidebar-link">MySQL8.0.12--secure-file-priv数据导出问题解决</a></li><li><a href="/2019/React_V16入门手册.html" class="sidebar-link">React_V16入门手册</a></li><li><a href="/2019/react16配置.html" class="sidebar-link">/2019/react16配置.html</a></li><li><a href="/2019/react生命周期.html" class="sidebar-link">react生命周期</a></li><li><a href="/2019/React虚拟dom和diff算法.html" class="sidebar-link">React虚拟dom和diff算法</a></li><li><a href="/2019/React学习笔记.html" class="sidebar-link">React学习笔记</a></li><li><a href="/2019/Vue使用踩坑记录.html" class="sidebar-link">Vue使用踩坑记录</a></li><li><a href="/2019/vue中AsyncAwait的使用示例.html" class="sidebar-link">vue中AsyncAwait的使用示例</a></li><li><a href="/2019/webpack下build报错.html" class="sidebar-link">webpack下build报错</a></li><li><a href="/2019/zabbix平台搭建.html" class="sidebar-link">zabbix平台搭建</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>others</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>本文将介绍强制缓存（200）和协商缓存（304）的区别</p> <h4 id="_1-什么是缓存？"><a href="#_1-什么是缓存？" class="header-anchor">#</a> 1. 什么是缓存？</h4> <p>浏览器缓存(Brower Caching)是浏览器对之前请求过的文件进行缓存，以便下一次访问时重复使用，节省带宽，提高访问速度，降低服务器压力</p> <p>http缓存机制主要在http响应头中设定，响应头中相关字段为Expires、Cache-Control、Last-Modified、If-Modified-Since、Etag。</p> <p>HTTP 1.0协议中的。简而言之，就是告诉浏览器在约定的这个时间前，可以直接从缓存中获取资源（representations），而无需跑到服务器去获取。</p> <p>另：Expires因为是对时间设定的，且时间是Greenwich Mean Time （GMT），而不是本地时间，所以对时间要求较高。</p> <h4 id="_2-浏览器是如何判断是否使用缓存的"><a href="#_2-浏览器是如何判断是否使用缓存的" class="header-anchor">#</a> 2. 浏览器是如何判断是否使用缓存的</h4> <p>第一次请求：</p> <p><img src="https://user-gold-cdn.xitu.io/2019/5/6/16a8bbc2df77f4f6?w=411&amp;h=369&amp;f=png&amp;s=26885" alt="">
第二次请求相同网页：</p> <p><img src="https://user-gold-cdn.xitu.io/2019/5/6/16a8bbaefa56810f?w=554&amp;h=528&amp;f=png&amp;s=103197" alt=""></p> <h4 id="_3-缓存的类别"><a href="#_3-缓存的类别" class="header-anchor">#</a> 3. 缓存的类别</h4> <p>浏览器缓存分为强缓存和协商缓存</p> <h5 id="强缓存：浏览器不会像服务器发送任何请求，直接从本地缓存中读取文件并返回status-code-200-ok"><a href="#强缓存：浏览器不会像服务器发送任何请求，直接从本地缓存中读取文件并返回status-code-200-ok" class="header-anchor">#</a> 强缓存：浏览器不会像服务器发送任何请求，直接从本地缓存中读取文件并返回Status Code: 200 OK</h5> <p><img src="https://user-gold-cdn.xitu.io/2019/5/6/16a8bc0c7e54f6ec?w=317&amp;h=112&amp;f=png&amp;s=9790" alt=""></p> <p><img src="https://user-gold-cdn.xitu.io/2019/5/6/16a8bdbc4b9c8720?w=280&amp;h=96&amp;f=png&amp;s=7498" alt=""></p> <blockquote><p>200 form memory cache :
不访问服务器，一般已经加载过该资源且缓存在了内存当中，直接从内存中读取缓存。浏览器关闭后，数据将不存在（资源被释放掉了），再次打开相同的页面时，不会出现from memory cache。</p></blockquote> <blockquote><p>200 from disk cache：
不访问服务器，已经在之前的某个时间加载过该资源，直接从硬盘中读取缓存，关闭浏览器后，数据依然存在，此资源不会随着该页面的关闭而释放掉下次打开仍然会是from disk cache。</p></blockquote> <blockquote><p>优先访问memory cache,其次是disk cache，最后是请求网络资源</p></blockquote> <h5 id="协商缓存-向服务器发送请求，服务器会根据这个请求的request-header的一些参数来判断是否命中协商缓存，如果命中，则返回304状态码并带上新的response-header通知浏览器从缓存中读取资源；"><a href="#协商缓存-向服务器发送请求，服务器会根据这个请求的request-header的一些参数来判断是否命中协商缓存，如果命中，则返回304状态码并带上新的response-header通知浏览器从缓存中读取资源；" class="header-anchor">#</a> 协商缓存: 向服务器发送请求，服务器会根据这个请求的request header的一些参数来判断是否命中协商缓存，如果命中，则返回304状态码并带上新的response header通知浏览器从缓存中读取资源；</h5> <p><img src="https://user-gold-cdn.xitu.io/2019/5/6/16a8bc3172e3a167?w=293&amp;h=47&amp;f=png&amp;s=3340" alt=""></p> <h4 id="_4-强缓存和协商缓存的header参数"><a href="#_4-强缓存和协商缓存的header参数" class="header-anchor">#</a> 4. 强缓存和协商缓存的header参数</h4> <p>强缓存：</p> <p>Expires：过期时间，如果设置了时间，则浏览器会在设置的时间内直接读取缓存，不再请求</p> <p>Cache-Control：当值设为max-age=300时，则代表在这个请求正确返回时间（浏览器也会记录下来）的5分钟内再次加载资源，就会命中强缓存。</p> <p>cache-control：除了该字段外，还有下面几个比较常用的设置值：</p> <pre><code>（1） max-age：用来设置资源（representations）可以被缓存多长时间，单位为秒；
（2） s-maxage：和max-age是一样的，不过它只针对代理服务器缓存而言；
（3）public：指示响应可被任何缓存区缓存；
（4）private：只能针对个人用户，而不能被代理服务器缓存；
（5）no-cache：强制客户端直接向服务器发送请求,也就是说每次请求都必须向服务器发送。服务器接收到     请求，然后判断资源是否变更，是则返回新内容，否则返回304，未变更。这个很容易让人产生误解，使人误     以为是响应不被缓存。实际上Cache-Control:     no-cache是会被缓存的，只不过每次在向客户端（浏览器）提供响应数据时，缓存都要向服务器评估缓存响应的有效性。
（6）no-store：禁止一切缓存（这个才是响应不被缓存的意思）。
</code></pre> <p>协商缓存：</p> <p>Last-Modifued/If-Modified-Since和Etag/If-None-Match是分别成对出现的，呈一一对应关系</p> <h5 id="etag-if-none-match："><a href="#etag-if-none-match：" class="header-anchor">#</a> Etag/If-None-Match：</h5> <p>Etag：</p> <blockquote><p>Etag是属于HTTP 1.1属性，它是由服务器（Apache或者其他工具）生成返回给前端，用来帮助服务器控制Web端的缓存验证。
Apache中，ETag的值，默认是对文件的索引节（INode），大小（Size）和最后修改时间（MTime）进行Hash后得到的。</p></blockquote> <p>If-None-Match:</p> <blockquote><p>当资源过期时，浏览器发现响应头里有Etag,则再次像服务器请求时带上请求头if-none-match(值是Etag的值)。服务器收到请求进行比对，决定返回200或304</p></blockquote> <p><img src="https://user-gold-cdn.xitu.io/2019/5/6/16a8c60fb0ef49f0?w=918&amp;h=279&amp;f=png&amp;s=20766" alt=""></p> <h5 id="last-modifued-if-modified-since："><a href="#last-modifued-if-modified-since：" class="header-anchor">#</a> Last-Modifued/If-Modified-Since：</h5> <p>Last-Modified：</p> <blockquote><p>浏览器向服务器发送资源最后的修改时间</p></blockquote> <p>If-Modified-Since：</p> <blockquote><p>当资源过期时（浏览器判断Cache-Control标识的max-age过期），发现响应头具有Last-Modified声明，则再次像服务器请求时带上头if-modified-since，表示请求时间。服务器收到请求后发现有if-modified-since则与被请求资源的最后修改时间进行对比（Last-Modified）,若最后修改时间较新（大），说明资源又被改过，则返回最新资源，HTTP 200 OK;若最后修改时间较旧（小），说明资源无新修改，响应HTTP 304 走缓存。</p></blockquote> <blockquote><p>Last-Modifued/If-Modified-Since的时间精度是秒，而Etag可以更精确。
Etag优先级是高于Last-Modifued的，所以服务器会优先验证Etag</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/2019/前端知识点190111.html" class="prev">前端知识点1901</a></span> <span class="next"><a href="/2019/如何理解es6中的class以及class中的constructor函数.html">如何理解es6中的class以及class中的constructor函数</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4498c43d.js" defer></script><script src="/assets/js/2.b4182e24.js" defer></script><script src="/assets/js/32.867850a9.js" defer></script>
  </body>
</html>
